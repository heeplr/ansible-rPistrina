# enable ssh server on first boot
- name: enabling ssh server
  file:
    path: "{{ mountpoint_boot }}/ssh"
    state: touch
  become: yes
# create ~/.ssh dir
- name: creating ~/.ssh
  file:
    path: "{{ mountpoint_root }}/home/pi/.ssh"
    state: directory
    mode: 0700
    owner: "1000"
    group: "1000"
  become: yes
# generate keypair
- name: generating ssh key
  openssh_keypair:
    type: ed25519
    path: "{{ mountpoint_root }}/home/pi/.ssh/id_ed25519"
    mode: 600
    owner: "1000"
    group: "1000"
  when: ssh_generate_keypair == true
# copy custom authorized_keys
- name: copying authorized_keys file
  template:
    src: "{{ ssh_authorized_keys_template }}"
    dest: "{{ mountpoint_root }}/home/pi/.ssh/authorized_keys"
    mode: 600
    owner: "1000"
    group: "1000"
  become: yes
